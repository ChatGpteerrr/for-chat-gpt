local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local root = char:WaitForChild("HumanoidRootPart")
local hum = char:WaitForChild("Humanoid")

player.CharacterAdded:Connect(function(newChar)
    char = newChar
    root = newChar:WaitForChild("HumanoidRootPart")
    hum = newChar:WaitForChild("Humanoid")
end)

local RANGE = 30
local studs = 8
local F_OFFSET = 3
local B_OFFSET = 3
local BASE_CD = 0.3
local speedMult = 0.8

local function getCD()
    if speedMult <= 0.05 then
        speedMult = 0.05
    end
    return BASE_CD / speedMult
end

local MIN_DIST = 1.2
local MAX_DIST = 14
local ANIM_L = 10480796021
local ANIM_R = 10480793962
local SOUND_ID = 10480793962

local dashing = false
local animTrack = nil
local espOn = false
local m1On = false
local dashKeyOn = false
local targetNearOn = false
local selectedPlr = nil

local function getEvent()
    local c = player.Character or player.CharacterAdded:Wait()
    if c then
        return c:FindFirstChild("Communicate")
    end
    return nil
end

local function fireEvent(data)
    pcall(function()
        local e = getEvent()
        if e and type(e.FireServer) == "function" then
            e:FireServer(unpack(data))
        end
    end)
end

local function sendDash()
    fireEvent({
        [1] = {
            Dash = Enum.KeyCode.W,
            Key = Enum.KeyCode.Q,
            Goal = "KeyPress",
        },
    })
end

local function click()
    local press = {
        [1] = {
            Mobile = true,
            Goal = "LeftClick",
        },
    }
    local release = {
        [1] = {
            Goal = "LeftClickRelease",
            Mobile = true,
        },
    }
    
    pcall(function()
        local e = getEvent()
        if e and type(e.FireServer) == "function" then
            e:FireServer(unpack(press))
            wait(0.06)
            e:FireServer(unpack(release))
        end
    end)
end

local sound = Instance.new("Sound")
sound.Name = "DashSFX"
sound.SoundId = "rbxassetid://72014632956520"
sound.Volume = 2
sound.Looped = false
sound.Parent = Workspace

local function angleDiff(a, b)
    local diff = a - b
    while math.pi < diff do
        diff = diff - 2 * math.pi
    end
    while diff < -math.pi do
        diff = diff + 2 * math.pi
    end
    return diff
end

local function ease(t)
    t = math.clamp(t, 0, 1)
    return 1 - (1 - t) ^ 3
end

local function getHumAndAnim()
    if not char or not char.Parent then
        return nil, nil
    end
    local h = char:FindFirstChildOfClass("Humanoid") or char:FindFirstChild("Humanoid")
    if not h then
        return nil, nil
    end
    local a = h:FindFirstChildOfClass("Animator")
    if not a then
        a = Instance.new("Animator")
        a.Name = "Animator"
        a.Parent = h
    end
    return h, a
end

local function playAnim(isLeft, dur)
    pcall(function()
        if animTrack and animTrack.IsPlaying then
            animTrack:Stop()
        end
        animTrack = nil
    end)
    
    local h, a = getHumAndAnim()
    if not h or not a then
        return
    end
    
    local id = isLeft and ANIM_L or ANIM_R
    if not id then
        return
    end
    
    local anim = Instance.new("Animation")
    anim.Name = "CircularSideAnim"
    anim.AnimationId = "rbxassetid://" .. tostring(id)
    
    local success, track = pcall(function()
        return a:LoadAnimation(anim)
    end)
    
    if not success or not track then
        anim:Destroy()
        return
    end
    
    animTrack = track
    track.Priority = Enum.AnimationPriority.Action
    track:Play()
    
    pcall(function()
        if sound and sound.Parent then
            sound:Stop()
            sound:Play()
        end
    end)
    
    delay((dur or BASE_CD) + 0.15, function()
        if track and track.IsPlaying then
            pcall(function()
                track:Stop()
            end)
        end
        pcall(function()
            anim:Destroy()
        end)
    end)
end

local function findTarget(range)
    range = range or RANGE
    if not root then
        return nil, nil
    end
    
    local myPos = root.Position
    local nearest = nil
    local dist = math.huge
    
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            local tRoot = plr.Character:FindFirstChild("HumanoidRootPart")
            local tHum = plr.Character:FindFirstChild("Humanoid")
            if tRoot and tHum and tHum.Health > 0 then
                local d = (tRoot.Position - myPos).Magnitude
                if d < dist and d <= range then
                    nearest = plr.Character
                    dist = d
                end
            end
        end
    end
    
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj:FindFirstChild("HumanoidRootPart") then
            if not Players:GetPlayerFromCharacter(obj) then
                local tHum = obj:FindFirstChild("Humanoid")
                local tRoot = obj:FindFirstChild("HumanoidRootPart")
                if tHum and tHum.Health > 0 and tRoot then
                    local d = (tRoot.Position - myPos).Magnitude
                    if d < dist and d <= range then
                        nearest = obj
                        dist = d
                    end
                end
            end
        end
    end
    
    return nearest, dist
end

local function dash(target)
    if dashing then
        return false
    end
    if not target or not target:FindFirstChild("HumanoidRootPart") then
        return false
    end
    if not root then
        return false
    end
    
    dashing = true
    
    local tRoot = target.HumanoidRootPart
    local tPos = tRoot.Position
    local myPos = root.Position
    local tLook = tRoot.CFrame.LookVector
    
    local dot = tLook:Dot(myPos - tPos)
    local endPos
    
    if dot > 0 then
        endPos = tPos - tLook * F_OFFSET
    else
        endPos = tPos + tLook * B_OFFSET
    end
    
    endPos = Vector3.new(endPos.X, tPos.Y + 0.5, endPos.Z)
    
    local horDist = (Vector3.new(myPos.X, 0, myPos.Z) - Vector3.new(tPos.X, 0, tPos.Z)).Magnitude
    local clampDist = math.clamp(studs, MIN_DIST, MAX_DIST)
    
    local dashOff = (Vector3.new(endPos.X, 0, endPos.Z) - Vector3.new(tPos.X, 0, tPos.Z)).Magnitude
    local angleTo = math.atan2(myPos.Z - tPos.Z, myPos.X - tPos.X)
    local angleOff = angleDiff(math.atan2(endPos.Z - tPos.Z, endPos.X - tPos.X), angleTo)
    local isLeft = angleOff > 0
    
    local cd = getCD()
    
    pcall(function()
        playAnim(isLeft, cd)
    end)
    
    local cam = Workspace.CurrentCamera
    local autoRot = nil
    
    pcall(function()
        if hum then
            autoRot = hum.AutoRotate
        end
        if hum then
            hum.AutoRotate = false
        end
    end)
    
    local startLook = root.CFrame.LookVector
    local startAng = math.atan2(startLook.Z, startLook.X)
    local startTime = tick()
    local lastUp = startTime
    
    local conn = nil
    conn = RunService.Heartbeat:Connect(function(dt)
        if not tRoot or not tRoot.Parent then
            if hum and autoRot ~= nil then
                pcall(function()
                    hum.AutoRotate = autoRot
                end)
            end
            if conn and conn.Connected then
                conn:Disconnect()
            end
            dashing = false
            return
        end
        
        local now = tick()
        local prog = math.clamp((now - startTime) / cd, 0, 1)
        local eased = ease(prog)
        
        local curAng
        
        if prog <= 0.5 then
            curAng = horDist + (clampDist - horDist) * ease(prog / 0.5)
        else
            curAng = clampDist + (dashOff - clampDist) * ease((prog - 0.5) / 0.5)
        end
        
        curAng = math.clamp(curAng, MIN_DIST, MAX_DIST)
        
        local curTargetAng = angleTo + angleOff * eased
        local newPos = Vector3.new(
            tPos.X + curAng * math.cos(curTargetAng),
            myPos.Y + (endPos.Y - myPos.Y) * eased,
            tPos.Z + curAng * math.sin(curTargetAng)
        )
        
        local lookDir = tRoot.Position - newPos
        if lookDir.Magnitude < 0.001 then
            lookDir = Vector3.new(tLook.X, 0, tLook.Z)
        end
        
        local lookAng = math.atan2(lookDir.Z, lookDir.X)
        local curLookAng = startAng + angleDiff(lookAng, startAng) * eased
        local curLookVec = Vector3.new(math.cos(curLookAng), 0, math.sin(curLookAng))
        
        local dtTime = math.max(0.0001, now - lastUp)
        lastUp = now
        local vel = (newPos - root.Position) / dtTime
        
        pcall(function()
            if root and root.Parent then
                root.AssemblyLinearVelocity = vel
            end
        end)
        
        pcall(function()
            if root and root.Parent then
                root.CFrame = CFrame.new(root.Position, root.Position + curLookVec)
            end
        end)
        
        pcall(function()
            if cam and cam.CFrame and tRoot and tRoot.Parent then
                cam.CFrame = CFrame.new(cam.CFrame.Position, tRoot.Position)
            end
        end)
        
        if prog >= 1 then
            if conn and conn.Connected then
                conn:Disconnect()
            end
            
            pcall(function()
                if root and root.Parent then
                    root.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                    root.CFrame = CFrame.new(newPos, newPos + Vector3.new(math.cos(lookAng), 0, math.sin(lookAng)))
                end
            end)
            
            pcall(function()
                if animTrack and animTrack.IsPlaying then
                    animTrack:Stop()
                end
                animTrack = nil
            end)
            
            if hum and autoRot ~= nil then
                pcall(function()
                    hum.AutoRotate = autoRot
                end)
            end
            
            dashing = false
        end
    end)
    
    return true
end

local gui = Instance.new("ScreenGui")
gui.Name = "SettingsGUI_Merged"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local clickSnd = Instance.new("Sound")
clickSnd.SoundId = "rbxassetid://6042053626"
clickSnd.Volume = 0.7
clickSnd.Parent = gui

local function drag(frame)
    local dragging = false
    local startPos = nil
    local frameStart = nil
    local inputObj = nil
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            startPos = input.Position
            frameStart = frame.Position
            inputObj = input
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
            if input == inputObj then
                local delta = input.Position - startPos
                frame.Position = UDim2.new(
                    frameStart.X.Scale,
                    frameStart.X.Offset + delta.X,
                    frameStart.Y.Scale,
                    frameStart.Y.Offset + delta.Y
                )
            end
        end
    end)
end

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 280, 0, 270)
mainFrame.Position = UDim2.new(0.5, -140, 0.5, -135)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.BackgroundTransparency = 0.3
mainFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BorderSizePixel = 2
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.ClipsDescendants = true
mainFrame.Parent = gui

local corner = Instance.new("UICorner", mainFrame)
corner.CornerRadius = UDim.new(0, 12)

mainFrame.Visible = true
mainFrame.Size = UDim2.new(0, 0, 0, 0)
TweenService:Create(mainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 280, 0, 270),
}):Play()

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 35)
title.BackgroundColor3 = Color3.fromRGB(235, 235, 235)
title.BackgroundTransparency = 0
title.Text = "Sidedash Settings"
title.TextColor3 = Color3.fromRGB(0, 0, 0)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.Parent = mainFrame

local titleCorner = Instance.new("UICorner", title)
titleCorner.CornerRadius = UDim.new(0, 12)

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 35, 0, 35)
closeBtn.Position = UDim2.new(1, -40, 0, 0)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
closeBtn.Text = "-"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
closeBtn.TextSize = 20
closeBtn.Parent = mainFrame

local closeCorner = Instance.new("UICorner", closeBtn)
closeCorner.CornerRadius = UDim.new(1, 0)

local toggles = Instance.new("Frame")
toggles.Size = UDim2.new(1, -20, 0, 90)
toggles.Position = UDim2.new(0, 10, 0, 45)
toggles.BackgroundTransparency = 1
toggles.Parent = mainFrame

local grid = Instance.new("UIGridLayout")
grid.CellSize = UDim2.new(0.5, -10, 0, 35)
grid.CellPadding = UDim2.new(0, 10, 0, 10)
grid.HorizontalAlignment = Enum.HorizontalAlignment.Center
grid.VerticalAlignment = Enum.VerticalAlignment.Top
grid.Parent = toggles

local espFolder = Instance.new("Folder", gui)
espFolder.Name = "ESPFolder"

local function clearESP()
    for _, obj in ipairs(espFolder:GetChildren()) do
        obj:Destroy()
    end
end

local function makeESP(target)
    clearESP()
    if not target or not target.Parent then
        return
    end
    
    local rootPart = target:FindFirstChild("HumanoidRootPart") or target.PrimaryPart or target:FindFirstChildWhichIsA("BasePart")
    if not rootPart then
        return
    end
    
    local billboard = Instance.new("BillboardGui")
    billboard.Size = UDim2.new(0, 120, 0, 40)
    billboard.Adornee = rootPart
    billboard.AlwaysOnTop = true
    billboard.Parent = espFolder
    billboard.StudsOffset = Vector3.new(0, 4, 0)
    
    local bg = Instance.new("Frame")
    bg.Size = UDim2.new(1, 0, 1, 0)
    bg.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    bg.BackgroundTransparency = 0.2
    bg.BorderSizePixel = 0
    bg.Parent = billboard
    
    local bgCorner = Instance.new("UICorner", bg)
    bgCorner.CornerRadius = UDim.new(0, 6)
    
    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(1, 0, 1, 0)
    text.BackgroundTransparency = 1
    text.Text = target.Name or "Target"
    text.Font = Enum.Font.GothamBold
    text.TextSize = 16
    text.TextColor3 = Color3.fromRGB(255, 255, 255)
    text.TextStrokeTransparency = 0.5
    text.TextScaled = false
    text.Parent = billboard
end

local function addToggle(name, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 100, 0, 35)
    btn.BackgroundColor3 = Color3.fromRGB(245, 245, 245)
    btn.Text = name
    btn.TextColor3 = Color3.fromRGB(0, 0, 0)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.AutoButtonColor = false
    btn.Parent = toggles
    
    local btnCorner = Instance.new("UICorner", btn)
    btnCorner.CornerRadius = UDim.new(0, 8)
    
    local ind = Instance.new("Frame")
    ind.Size = UDim2.new(0, 15, 0, 15)
    ind.Position = UDim2.new(1, -24, 0.5, -7)
    ind.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
    ind.Parent = btn
    
    local indCorner = Instance.new("UICorner", ind)
    indCorner.CornerRadius = UDim.new(1, 0)
    
    local on = false
    
    btn.MouseButton1Click:Connect(function()
        clickSnd:Play()
        on = not on
        
        TweenService:Create(ind, TweenInfo.new(0.16), {
            BackgroundColor3 = on and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(180, 180, 180),
        }):Play()
        
        btn:TweenSize(UDim2.new(0, 95, 0, 30), "Out", "Quad", 0.09, true, function()
            btn:TweenSize(UDim2.new(0, 100, 0, 35), "Out", "Quad", 0.09)
        end)
        
        if callback then
            callback(on)
        end
    end)
    
    return btn
end

addToggle("Target Near", function(on)
    targetNearOn = on
    if on then
        selectedPlr = nil
        if espOn and root then
            local near = findTarget(RANGE)
            if near then
                makeESP(near)
            end
        else
            clearESP()
        end
    else
        clearESP()
    end
end)

addToggle("M1", function(on)
    m1On = on
end)

addToggle("Dash", function(on)
    dashKeyOn = on
end)

addToggle("ESP", function(on)
    espOn = on
    if not on then
        clearESP()
    else
        local t = nil
        if selectedPlr and selectedPlr.Character then
            t = selectedPlr.Character
        elseif targetNearOn then
            t = findTarget(RANGE)
        end
        
        if t then
            makeESP(t)
        end
    end
end)

local plrFrame = Instance.new("ScrollingFrame")
plrFrame.Size = UDim2.new(1, -20, 0, 70)
plrFrame.Position = UDim2.new(0, 10, 0, 145)
plrFrame.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
plrFrame.ScrollBarThickness = 4
plrFrame.Parent = mainFrame

local listCorner = Instance.new("UICorner", plrFrame)
listCorner.CornerRadius = UDim.new(0, 8)

local plrLayout = Instance.new("UIListLayout")
plrLayout.Parent = plrFrame
plrLayout.Padding = UDim.new(0, 2)

local function refreshList()
    for _, obj in ipairs(plrFrame:GetChildren()) do
        if obj:IsA("TextButton") then
            obj:Destroy()
        end
    end
    
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player then
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, -5, 0, 22)
            btn.BackgroundColor3 = Color3.fromRGB(235, 235, 235)
            btn.TextColor3 = Color3.fromRGB(0, 0, 0)
            btn.TextXAlignment = Enum.TextXAlignment.Left
            btn.TextSize = 14
            btn.Font = Enum.Font.Gotham
            btn.Text = "   " .. plr.Name
            btn.Parent = plrFrame
            
            local btnCorner = Instance.new("UICorner", btn)
            btnCorner.CornerRadius = UDim.new(0, 6)
            
            btn.MouseButton1Click:Connect(function()
                clickSnd:Play()
                
                for _, other in ipairs(plrFrame:GetChildren()) do
                    if other:IsA("TextButton") then
                        other.BackgroundColor3 = Color3.fromRGB(235, 235, 235)
                    end
                end
                
                btn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
                selectedPlr = plr
                targetNearOn = false
                
                if espOn and plr.Character then
                    makeESP(plr.Character)
                end
                
                print("Selected player:", plr.Name)
            end)
        end
    end
end

refreshList()

local refreshBtn = Instance.new("TextButton")
refreshBtn.Size = UDim2.new(0, 90, 0, 28)
refreshBtn.Position = UDim2.new(1, -100, 1, -35)
refreshBtn.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
refreshBtn.Text = "Refresh"
refreshBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
refreshBtn.Font = Enum.Font.GothamBold
refreshBtn.TextSize = 14
refreshBtn.Parent = mainFrame

local refreshCorner = Instance.new("UICorner", refreshBtn)
refreshCorner.CornerRadius = UDim.new(0, 8)

refreshBtn.MouseButton1Click:Connect(function()
    clickSnd:Play()
    refreshList()
end)

local adjustMenu = nil

local function makeAdjustMenu()
    if adjustMenu and adjustMenu.Parent then
        return
    end
    
    adjustMenu = Instance.new("Frame")
    adjustMenu.Name = "AdjustMiniMenu"
    adjustMenu.Size = UDim2.new(0, 260, 0, 120)
    adjustMenu.Position = UDim2.new(0.5, -130, 0.5, -60)
    adjustMenu.BackgroundColor3 = Color3.fromRGB(245, 245, 245)
    adjustMenu.BorderSizePixel = 2
    adjustMenu.Parent = gui
    
    local adjCorner = Instance.new("UICorner", adjustMenu)
    adjCorner.CornerRadius = UDim.new(0, 12)
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Position = UDim2.new(0, 0, 0, 8)
    title.BackgroundTransparency = 1
    title.Text = "Adjust Settings"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextColor3 = Color3.fromRGB(25, 25, 25)
    title.Parent = adjustMenu
    
    local studsLabel = Instance.new("TextLabel")
    studsLabel.Size = UDim2.new(0, 70, 0, 28)
    studsLabel.Position = UDim2.new(0, 12, 0, 46)
    studsLabel.BackgroundTransparency = 1
    studsLabel.Text = "Studs"
    studsLabel.Font = Enum.Font.Gotham
    studsLabel.TextSize = 16
    studsLabel.TextColor3 = Color3.fromRGB(25, 25, 25)
    studsLabel.TextXAlignment = Enum.TextXAlignment.Left
    studsLabel.Parent = adjustMenu
    
    local studsVal = Instance.new("TextLabel")
    studsVal.Size = UDim2.new(0, 50, 0, 28)
    studsVal.Position = UDim2.new(0, 110, 0, 46)
    studsVal.BackgroundTransparency = 1
    studsVal.Text = tostring(studs)
    studsVal.Font = Enum.Font.GothamBold
    studsVal.TextSize = 16
    studsVal.TextColor3 = Color3.fromRGB(25, 25, 25)
    studsVal.TextXAlignment = Enum.TextXAlignment.Center
    studsVal.Parent = adjustMenu
    
    local studsMinus = Instance.new("TextButton")
    studsMinus.Size = UDim2.new(0, 32, 0, 32)
    studsMinus.Position = UDim2.new(0, 170, 0, 44)
    studsMinus.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
    studsMinus.Text = "-"
    studsMinus.Font = Enum.Font.GothamBold
    studsMinus.TextSize = 20
    studsMinus.TextColor3 = Color3.fromRGB(255, 255, 255)
    studsMinus.Parent = adjustMenu
    
    local studsMinusCorner = Instance.new("UICorner", studsMinus)
    studsMinusCorner.CornerRadius = UDim.new(0, 8)
    
    local studsPlus = Instance.new("TextButton")
    studsPlus.Size = UDim2.new(0, 32, 0, 32)
    studsPlus.Position = UDim2.new(0, 210, 0, 44)
    studsPlus.BackgroundColor3 = Color3.fromRGB(80, 200, 100)
    studsPlus.Text = "+"
    studsPlus.Font = Enum.Font.GothamBold
    studsPlus.TextSize = 20
    studsPlus.TextColor3 = Color3.fromRGB(255, 255, 255)
    studsPlus.Parent = adjustMenu
    
    local studsPlusCorner = Instance.new("UICorner", studsPlus)
    studsPlusCorner.CornerRadius = UDim.new(0, 8)
    
    local speedLabel = Instance.new("TextLabel")
    speedLabel.Size = UDim2.new(0, 70, 0, 28)
    speedLabel.Position = UDim2.new(0, 12, 0, 82)
    speedLabel.BackgroundTransparency = 1
    speedLabel.Text = "Speed"
    speedLabel.Font = Enum.Font.Gotham
    speedLabel.TextSize = 16
    speedLabel.TextColor3 = Color3.fromRGB(25, 25, 25)
    speedLabel.TextXAlignment = Enum.TextXAlignment.Left
    speedLabel.Parent = adjustMenu
    
    local speedVal = Instance.new("TextLabel")
    speedVal.Size = UDim2.new(0, 50, 0, 28)
    speedVal.Position = UDim2.new(0, 110, 0, 82)
    speedVal.BackgroundTransparency = 1
    speedVal.Text = string.format("%.1f", speedMult)
    speedVal.Font = Enum.Font.GothamBold
    speedVal.TextSize = 16
    speedVal.TextColor3 = Color3.fromRGB(25, 25, 25)
    speedVal.TextXAlignment = Enum.TextXAlignment.Center
    speedVal.Parent = adjustMenu
    
    local speedMinus = Instance.new("TextButton")
    speedMinus.Size = UDim2.new(0, 32, 0, 32)
    speedMinus.Position = UDim2.new(0, 170, 0, 80)
    speedMinus.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
    speedMinus.Text = "-"
    speedMinus.Font = Enum.Font.GothamBold
    speedMinus.TextSize = 20
    speedMinus.TextColor3 = Color3.fromRGB(255, 255, 255)
    speedMinus.Parent = adjustMenu
    
    local speedMinusCorner = Instance.new("UICorner", speedMinus)
    speedMinusCorner.CornerRadius = UDim.new(0, 8)
    
    local speedPlus = Instance.new("TextButton")
    speedPlus.Size = UDim2.new(0, 32, 0, 32)
    speedPlus.Position = UDim2.new(0, 210, 0, 80)
    speedPlus.BackgroundColor3 = Color3.fromRGB(80, 200, 100)
    speedPlus.Text = "+"
    speedPlus.Font = Enum.Font.GothamBold
    speedPlus.TextSize = 20
    speedPlus.TextColor3 = Color3.fromRGB(255, 255, 255)
    speedPlus.Parent = adjustMenu
    
    local speedPlusCorner = Instance.new("UICorner", speedPlus)
    speedPlusCorner.CornerRadius = UDim.new(0, 8)
    
    studsMinus.MouseButton1Click:Connect(function()
        studs = math.max(0.5, studs - 1)
        studsVal.Text = tostring(studs)
    end)
    
    studsPlus.MouseButton1Click:Connect(function()
        studs = math.min(40, studs + 1)
        studsVal.Text = tostring(studs)
    end)
    
    speedMinus.MouseButton1Click:Connect(function()
        speedMult = math.max(0.1, math.floor(((speedMult - 0.1) * 10 + 0.5)) / 10)
        speedVal.Text = string.format("%.1f", speedMult)
    end)
    
    speedPlus.MouseButton1Click:Connect(function()
        speedMult = math.min(5, math.floor(((speedMult + 0.1) * 10 + 0.5)) / 10)
        speedVal.Text = string.format("%.1f", speedMult)
    end)
    
    drag(adjustMenu)
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 22, 0, 22)
    closeBtn.Position = UDim2.new(1, -26, 0, 6)
    closeBtn.Text = "x"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 14
    closeBtn.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
    closeBtn.Parent = adjustMenu
    
    local closeBtnCorner = Instance.new("UICorner", closeBtn)
    closeBtnCorner.CornerRadius = UDim.new(0, 6)
    
    closeBtn.MouseButton1Click:Connect(function()
        if adjustMenu and adjustMenu.Parent then
            adjustMenu:Destroy()
            adjustMenu = nil
        end
    end)
end

local adjustBtn = Instance.new("TextButton")
adjustBtn.Size = UDim2.new(0, 80, 0, 28)
adjustBtn.Position = UDim2.new(0, 10, 1, -35)
adjustBtn.BackgroundColor3 = Color3.fromRGB(110, 110, 110)
adjustBtn.Text = "Adjust"
adjustBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
adjustBtn.Font = Enum.Font.GothamBold
adjustBtn.TextSize = 14
adjustBtn.Parent = mainFrame

local adjustBtnCorner = Instance.new("UICorner", adjustBtn)
adjustBtnCorner.CornerRadius = UDim.new(0, 8)

adjustBtn.MouseButton1Click:Connect(function()
    clickSnd:Play()
    if not adjustMenu or not adjustMenu.Parent then
        makeAdjustMenu()
    else
        adjustMenu:Destroy()
        adjustMenu = nil
    end
end)

local settingsBtn = Instance.new("TextButton")
settingsBtn.Size = UDim2.new(0, 100, 0, 45)
settingsBtn.Position = UDim2.new(0.5, -50, 0.5, -22)
settingsBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
settingsBtn.Text = "Settings"
settingsBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
settingsBtn.Font = Enum.Font.GothamBold
settingsBtn.TextSize = 16
settingsBtn.Visible = false
settingsBtn.Parent = gui
settingsBtn.BorderSizePixel = 2
settingsBtn.BorderColor3 = Color3.fromRGB(0, 0, 0)

local settingsBtnCorner = Instance.new("UICorner", settingsBtn)
settingsBtnCorner.CornerRadius = UDim.new(0, 10)

local function addEffect(btn, callback)
    btn.MouseButton1Click:Connect(function()
        btn:TweenSize(btn.Size - UDim2.new(0, 5, 0, 5), "Out", "Quad", 0.08, true, function()
            btn:TweenSize(btn.Size + UDim2.new(0, 5, 0, 5), "Out", "Quad", 0.08)
            if callback then
                callback()
            end
        end)
    end)
end

addEffect(closeBtn, function()
    clickSnd:Play()
    local t = TweenService:Create(mainFrame, TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 0),
    })
    t:Play()
    t.Completed:Wait()
    mainFrame.Visible = false
    settingsBtn.Visible = true
end)

addEffect(settingsBtn, function()
    clickSnd:Play()
    settingsBtn.Visible = false
    mainFrame.Visible = true
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    TweenService:Create(mainFrame, TweenInfo.new(0.38, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 280, 0, 270),
    }):Play()
end)

drag(mainFrame)
drag(settingsBtn)

print("Settings GUI loaded.")

local dashBtn = Instance.new("ImageButton")
dashBtn.Name = "DashButton_Merged"
dashBtn.Size = UDim2.new(0, 110, 0, 110)
dashBtn.Position = UDim2.new(0.5, -55, 0.8, -55)
dashBtn.BackgroundTransparency = 1
dashBtn.BorderSizePixel = 0
dashBtn.Image = "rbxassetid://99317918824094"
dashBtn.Parent = gui
dashBtn.Active = true

local btnScale = Instance.new("UIScale", dashBtn)
btnScale.Scale = 1

local pressSnd = Instance.new("Sound")
pressSnd.Name = "PressSFX"
pressSnd.SoundId = "rbxassetid://" .. tostring(SOUND_ID)
pressSnd.Volume = 0.9
pressSnd.Looped = false
pressSnd.Parent = dashBtn

local pressed = false
local dragging = false
local dragStart = nil
local btnStart = nil
local dragIn = nil
local DRAG_THRESH = 8

local function tweenScale(target, dur)
    dur = dur or 0.06
    local success, t = pcall(function()
        return TweenService:Create(btnScale, TweenInfo.new(dur, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Scale = target,
        })
    end)
    if success and t then
        t:Play()
    end
end

local function onInputStart(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
        pressed = true
        dragging = false
        dragStart = input.Position
        btnStart = dashBtn.Position
        dragIn = input
        
        tweenScale(0.92, 0.06)
        
        pcall(function()
            pressSnd:Play()
        end)
    end
end

local function onInputChange(input)
    if not pressed or not dragStart or input ~= dragIn then
        return
    end
    
    local delta = input.Position - dragStart
    
    if not dragging and delta.Magnitude >= DRAG_THRESH then
        dragging = true
        tweenScale(1, 0.06)
    end
    
    if dragging then
        local view = Workspace.CurrentCamera.ViewportSize
        dashBtn.Position = UDim2.new(
            0, math.clamp(btnStart.X.Offset + delta.X, 0, view.X - dashBtn.AbsoluteSize.X),
            0, math.clamp(btnStart.Y.Offset + delta.Y, 0, view.Y - dashBtn.AbsoluteSize.Y)
        )
    end
end

UserInputService.InputChanged:Connect(function(input)
    pcall(function()
        onInputChange(input)
    end)
end)

UserInputService.InputEnded:Connect(function(input)
    if input ~= dragIn or not pressed then
        return
    end
    
    if not dragging and not dashing then
        local t = nil
        
        if selectedPlr and selectedPlr.Character and selectedPlr.Character:FindFirstChild("HumanoidRootPart") then
            t = selectedPlr.Character
        elseif targetNearOn then
            t = findTarget(RANGE)
        else
            t = findTarget(RANGE)
        end
        
        if t then
            local success = false
            pcall(function()
                success = dash(t)
            end)
            
            if success then
                pcall(function()
                    pressSnd:Play()
                end)
                
                if m1On then
                    delay(0.15, function()
                        pcall(click)
                    end)
                end
                
                if dashKeyOn then
                    pcall(sendDash)
                end
            end
        end
    end
    
    tweenScale(1, 0.06)
    
    pressed = false
    dragging = false
    dragIn = nil
    btnStart = nil
    dragStart = nil
end)

dashBtn.InputBegan:Connect(function(input)
    pcall(function()
        onInputStart(input)
    end)
end)

UserInputService.InputBegan:Connect(function(input, processed)
    if processed then
        return
    end
    
    if dashing then
        return
    end
    
    local isDash = (input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.X) or
                      (input.UserInputType == Enum.UserInputType.Gamepad1 and input.KeyCode == Enum.KeyCode.DPadUp)
    
    if isDash then
        local t = nil
        
        if selectedPlr and selectedPlr.Character and selectedPlr.Character:FindFirstChild("HumanoidRootPart") then
            t = selectedPlr.Character
        elseif targetNearOn then
            t = findTarget(RANGE)
        else
            t = findTarget(RANGE)
        end
        
        if t then
            local success = false
            pcall(function()
                success = dash(t)
            end)
            
            if success then
                if m1On then
                    delay(0.15, function()
                        pcall(click)
                    end)
                end
                
                if dashKeyOn then
                    pcall(sendDash)
                end
            end
        end
    end
end)

Players.PlayerAdded:Connect(refreshList)
Players.PlayerRemoving:Connect(refreshList)

RunService.Heartbeat:Connect(function()
    if not espOn then
        return
    end
    
    local t = nil
    if selectedPlr and selectedPlr.Character and selectedPlr.Character:FindFirstChild("HumanoidRootPart") then
        t = selectedPlr.Character
    elseif targetNearOn then
        t = findTarget(RANGE)
    end
    
    if t then
        makeESP(t)
    else
        clearESP()
    end
end)

print("[Merged] Circular velocity-based movement + Settings updated and ready.")

local DISCORD = "https://discord.gg/WY9DYSkZDc"
local DELAY = 4
local Y_POS = 18

local wmGui = Instance.new("ScreenGui")
wmGui.Name = "MerebennieWatermark"
wmGui.ResetOnSpawn = false
wmGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
wmGui.Parent = player:WaitForChild("PlayerGui")

local wmFrame = Instance.new("Frame")
wmFrame.Name = "WatermarkFrame"
wmFrame.Size = UDim2.new(0, 330, 0, 72)
wmFrame.AnchorPoint = Vector2.new(1, 0)
wmFrame.Position = UDim2.new(1, 10, 0, Y_POS)
wmFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
wmFrame.BackgroundTransparency = 0.08
wmFrame.BorderSizePixel = 0
wmFrame.Parent = wmGui

local wmCorner = Instance.new("UICorner")
wmCorner.CornerRadius = UDim.new(0, 12)
wmCorner.Parent = wmFrame

local wmTitle = Instance.new("TextLabel")
wmTitle.Name = "Title"
wmTitle.BackgroundTransparency = 1
wmTitle.Size = UDim2.new(1, -28, 0, 28)
wmTitle.Position = UDim2.new(0, 14, 0, 8)
wmTitle.Text = "Cracked by ArchTheHonoredOne on YouTube"
wmTitle.Font = Enum.Font.GothamBold
wmTitle.TextSize = 18
wmTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
wmTitle.TextXAlignment = Enum.TextXAlignment.Left
wmTitle.Parent = wmFrame

local wmDesc = Instance.new("TextLabel")
wmDesc.Name = "Desc"
wmDesc.BackgroundTransparency = 1
wmDesc.Size = UDim2.new(1, -28, 0, 26)
wmDesc.Position = UDim2.new(0, 14, 0, 36)
wmDesc.Text = "Join our discord for more scripts: " .. DISCORD
wmDesc.Font = Enum.Font.SourceSans
wmDesc.TextSize = 14
wmDesc.TextColor3 = Color3.fromRGB(200, 200, 200)
wmDesc.TextXAlignment = Enum.TextXAlignment.Left
wmDesc.TextTruncate = Enum.TextTruncate.AtEnd
wmDesc.Parent = wmFrame

local copied = Instance.new("TextLabel")
copied.Name = "CopiedLabel"
copied.AnchorPoint = Vector2.new(1, 0)
copied.BackgroundTransparency = 1
copied.Size = UDim2.new(0.28, -8, 1, 0)
copied.Position = UDim2.new(1, -12, 0, 0)
copied.Text = ""
copied.Font = Enum.Font.GothamBold
copied.TextSize = 16
copied.TextColor3 = Color3.fromRGB(0, 200, 0)
copied.TextXAlignment = Enum.TextXAlignment.Center
copied.Visible = false
copied.Parent = wmFrame

local clickArea = Instance.new("TextButton")
clickArea.Name = "ClickArea"
clickArea.Size = UDim2.new(1, 0, 1, 0)
clickArea.Position = UDim2.new(0, 0, 0, 0)
clickArea.Text = ""
clickArea.BackgroundTransparency = 1
clickArea.AutoButtonColor = false
clickArea.Parent = wmFrame

local clickSndWm = Instance.new("Sound")
clickSndWm.Name = "ClickSound"
clickSndWm.SoundId = "rbxassetid://142376088"
clickSndWm.Volume = 1
clickSndWm.Parent = wmFrame

local tIn = TweenInfo.new(0.55, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
local tOut = TweenInfo.new(0.45, Enum.EasingStyle.Quart, Enum.EasingDirection.In)

local posShow = UDim2.new(1, -Y_POS, 0, Y_POS)
local posHide = UDim2.new(1, 10, 0, Y_POS)

TweenService:Create(wmFrame, tIn, {
    Position = posShow,
}):Play()

spawn(function()
    wait(tIn.Time + DELAY)
    TweenService:Create(wmFrame, tOut, {
        Position = posHide,
    }):Play()
    wait(tOut.Time + 0.06)
    pcall(function()
        wmGui:Destroy()
    end)
end)

local function copy(text)
    if pcall(function()
        if setclipboard then
            setclipboard(text)
            return true
        end
    end) then return true end
    
    if pcall(function()
        if syn and syn.set_clipboard then
            syn.set_clipboard(text)
            return true
        end
    end) then return true end
    
    if pcall(function()
        if write_clipboard then
            write_clipboard(text)
            return true
        end
    end) then return true end
    
    if pcall(function()
        if set_clipboard then
            set_clipboard(text)
            return true
        end
    end) then return true end
    
    return false
end

local function showCopy(text, success)
    copied.Text = text
    copied.TextColor3 = success and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(255, 100, 100)
    copied.Visible = true
    copied.TextTransparency = 1
    
    TweenService:Create(copied, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        TextTransparency = 0,
    }):Play()
    
    delay(1.35, function()
        TweenService:Create(copied, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            TextTransparency = 1,
        }):Play()
        wait(0.18)
        copied.Visible = false
    end)
end

clickArea.MouseButton1Click:Connect(function()
    pcall(function()
        clickSndWm:Play()
    end)
    
    if copy(DISCORD) then
        showCopy("COPIED!", true)
    else
        showCopy("COPY FAILED", false)
    end
end)