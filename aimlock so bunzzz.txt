local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

StarterGui:SetCore("SendNotification", {
    Title = "Aimlock",
    Text = "Aimbot Loaded",
    Duration = 2
})

task.delay(0.5, function()
    local aimlockGui = Instance.new("ScreenGui")
    aimlockGui.Name = "AimlockGui"
    aimlockGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    aimlockGui.ResetOnSpawn = false

    local watermarkLabel = Instance.new("TextLabel")
    watermarkLabel.Name = "Watermark"
    watermarkLabel.Parent = aimlockGui
    watermarkLabel.AnchorPoint = Vector2.new(0.5, 0)
    watermarkLabel.Position = UDim2.new(0.5, 0, 0.03, 0)
    watermarkLabel.Size = UDim2.new(0, 110, 0, 16)
    watermarkLabel.BackgroundTransparency = 1
    watermarkLabel.Text = "Made by Merebennie"
    watermarkLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    watermarkLabel.Font = Enum.Font.GothamBold
    watermarkLabel.TextScaled = true
    watermarkLabel.TextTransparency = 0.4
    watermarkLabel.ZIndex = 10

    local watermarkStroke = Instance.new("UIStroke", watermarkLabel)
    watermarkStroke.Color = Color3.new(0, 0, 0)
    watermarkStroke.Thickness = 1
    watermarkStroke.Transparency = 0.5

    local panelFrame = Instance.new("Frame")
    panelFrame.Name = "Panel"
    panelFrame.Parent = aimlockGui
    panelFrame.Size = UDim2.new(0, 120, 0, 38)
    panelFrame.Position = UDim2.new(0.5, -60, 0.12, 0)
    panelFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    panelFrame.BackgroundTransparency = 0.12
    panelFrame.BorderSizePixel = 0

    local panelCorner = Instance.new("UICorner", panelFrame)
    panelCorner.CornerRadius = UDim.new(0.45, 0)

    local isDragging = nil
    local dragInput = nil
    local dragStart = nil
    local startPosition = nil

    panelFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            dragStart = input.Position
            startPosition = panelFrame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    isDragging = false
                end
            end)
        end
    end)

    panelFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and isDragging then
            local delta = input.Position - dragStart
            panelFrame.Position = UDim2.new(
                startPosition.X.Scale,
                startPosition.X.Offset + delta.X,
                startPosition.Y.Scale,
                startPosition.Y.Offset + delta.Y
            )
        end
    end)

    local aimToggleButton = Instance.new("TextButton")
    aimToggleButton.Parent = panelFrame
    aimToggleButton.AnchorPoint = Vector2.new(0.5, 0.5)
    aimToggleButton.Position = UDim2.new(0.5, 0, 0.5, 0)
    aimToggleButton.Size = UDim2.new(0.88, 0, 0.78, 0)
    aimToggleButton.Text = "Aimbot OFF"
    aimToggleButton.TextColor3 = Color3.new(1, 1, 1)
    aimToggleButton.TextStrokeTransparency = 0.2
    aimToggleButton.TextStrokeColor3 = Color3.new(0, 0.2, 0)
    aimToggleButton.TextScaled = true
    aimToggleButton.Font = Enum.Font.GothamBold
    aimToggleButton.BackgroundColor3 = Color3.fromRGB(60, 200, 90)
    aimToggleButton.AutoButtonColor = true

    local toggleCorner = Instance.new("UICorner", aimToggleButton)
    toggleCorner.CornerRadius = UDim.new(0.45, 0)

    local aimlockEnabled = false
    local currentTarget = nil

    local function findClosestTargetInFOV()
        local character = LocalPlayer.Character
        local rootPart

        if character then
            rootPart = character:FindFirstChild("HumanoidRootPart")
        else
            rootPart = character
        end

        if not rootPart then
            return nil
        end

        local liveFolder = workspace:FindFirstChild("Live")
        if not liveFolder then
            return nil
        end

        local cameraLookVector = Camera.CFrame.LookVector
        local lowestAngle = 30
        local bestTarget = nil

        for _, model in ipairs(liveFolder:GetChildren()) do
            if model:IsA("Model") and model ~= character then
                local headPart = model:FindFirstChild("Head")
                local humanoid = model:FindFirstChild("Humanoid")

                if headPart and humanoid and humanoid.Health > 0 then
                    local directionToHead = (headPart.Position - Camera.CFrame.Position).Unit
                    local angle = math.deg(math.acos(math.clamp(cameraLookVector:Dot(directionToHead), -1, 1)))

                    if angle < lowestAngle then
                        bestTarget = model
                        lowestAngle = angle
                    end
                end
            end
        end

        return bestTarget
    end

    local function findClosestTargetByDistance(maxDistance)
        local distanceLimit = maxDistance or 20
        local character = LocalPlayer.Character
        local rootPart

        if character then
            rootPart = character:FindFirstChild("HumanoidRootPart")
        else
            rootPart = character
        end

        if not rootPart then
            return nil
        end

        local liveFolder = workspace:FindFirstChild("Live")
        if not liveFolder then
            return nil
        end

        local closestTarget = nil

        for _, model in ipairs(liveFolder:GetChildren()) do
            if model:IsA("Model") and model ~= character then
                local headPart = model:FindFirstChild("Head")
                local humanoid = model:FindFirstChild("Humanoid")

                if headPart and humanoid and humanoid.Health > 0 then
                    local distance = (headPart.Position - rootPart.Position).Magnitude

                    if distance < distanceLimit then
                        closestTarget = model
                        distanceLimit = distance
                    end
                end
            end
        end

        return closestTarget
    end

    RunService.Stepped:Connect(function()
        if aimlockEnabled then
            if not currentTarget then
                currentTarget = findClosestTargetInFOV()
            end

            if currentTarget then
                local targetHumanoid = currentTarget:FindFirstChild("Humanoid")

                if not currentTarget.Parent or not targetHumanoid or targetHumanoid.Health <= 0 then
                    currentTarget = findClosestTargetByDistance(20)
                end
            end

            if currentTarget then
                local targetHead = currentTarget:FindFirstChild("Head")
                local character = LocalPlayer.Character
                local rootPart

                if character then
                    rootPart = character:FindFirstChild("HumanoidRootPart")
                end

                if targetHead and rootPart then
                    local rootPosition = rootPart.Position
                    local targetPosition = targetHead.Position
                    local lookVectorFlat = Vector3.new(
                        targetPosition.X - rootPosition.X,
                        0,
                        targetPosition.Z - rootPosition.Z
                    )

                    if lookVectorFlat.Magnitude > 0.01 then
                        rootPart.CFrame = CFrame.new(rootPosition, rootPosition + lookVectorFlat)
                    end
                end
            end
        end
    end)

    local function updateToggleButtonVisual(enabled)
        if enabled then
            aimToggleButton.Text = "Aimbot ON"
            aimToggleButton.BackgroundColor3 = Color3.fromRGB(60, 220, 60)
        else
            aimToggleButton.Text = "Aimbot OFF"
            aimToggleButton.BackgroundColor3 = Color3.fromRGB(60, 200, 90)
        end
    end

    aimToggleButton.MouseButton1Click:Connect(function()
        if not isDragging then
            aimlockEnabled = not aimlockEnabled
            updateToggleButtonVisual(aimlockEnabled)

            if not aimlockEnabled then
                currentTarget = nil
            end
        end
    end)

    updateToggleButtonVisual(aimlockEnabled)
end)
